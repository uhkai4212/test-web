<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ScriptyNote</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: #0a0a0a;
            color: #ffffff;
            min-height: 100vh;
            overflow-x: hidden;
        }

        .background-gradient {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: radial-gradient(circle at 20% 20%, rgba(120, 119, 198, 0.1) 0%, transparent 50%),
                        radial-gradient(circle at 80% 80%, rgba(255, 119, 198, 0.1) 0%, transparent 50%),
                        radial-gradient(circle at 40% 40%, rgba(120, 219, 255, 0.1) 0%, transparent 50%);
            z-index: -1;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 2rem;
            position: relative;
            z-index: 1;
        }

        .header {
            text-align: center;
            margin-bottom: 3rem;
            animation: fadeInDown 0.8s ease-out;
        }

        .title {
            font-size: 3rem;
            font-weight: 700;
            background: linear-gradient(135deg, #ffffff, #b4b4b4);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 0.5rem;
        }

        .subtitle {
            font-size: 1.1rem;
            color: #999;
            opacity: 0;
            animation: fadeIn 0.8s ease-out 0.3s forwards;
        }

        .search-container {
            position: relative;
            margin-bottom: 2rem;
            animation: slideUp 0.8s ease-out 0.4s both;
        }

        .search-input {
            width: 100%;
            padding: 1rem 1.5rem 1rem 3rem;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 16px;
            color: #ffffff;
            font-size: 1rem;
            backdrop-filter: blur(10px);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .search-input:focus {
            outline: none;
            border-color: rgba(120, 119, 198, 0.5);
            background: rgba(255, 255, 255, 0.08);
            box-shadow: 0 0 0 1px rgba(120, 119, 198, 0.3);
        }

        .search-input::placeholder {
            color: #666;
        }

        .search-icon {
            position: absolute;
            left: 1rem;
            top: 50%;
            transform: translateY(-50%);
            color: #666;
            font-size: 1.1rem;
        }

        .notes-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 1.5rem;
            margin-bottom: 6rem;
        }

        .note-card {
            background: rgba(255, 255, 255, 0.03);
            border: 1px solid rgba(255, 255, 255, 0.08);
            border-radius: 20px;
            padding: 1.5rem;
            backdrop-filter: blur(20px);
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            cursor: pointer;
            opacity: 0;
            transform: translateY(20px);
            animation: noteAppear 0.6s ease-out forwards;
            position: relative;
        }

        .note-card:hover {
            transform: translateY(-8px);
            background: rgba(255, 255, 255, 0.06);
            border-color: rgba(255, 255, 255, 0.15);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
        }

        .note-card.selected {
            background: rgba(255, 255, 255, 0.08);
            border-color: rgba(120, 119, 198, 0.3);
        }

        .note-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }

        .note-user {
            font-weight: 600;
            color: #7877c6;
            font-size: 0.9rem;
        }

        .note-date {
            font-size: 0.8rem;
            color: #888;
        }

        .note-title {
            font-size: 1.2rem;
            font-weight: 600;
            margin-bottom: 0.5rem;
            color: #ffffff;
        }

        .note-content {
            color: #ccc;
            line-height: 1.6;
            font-size: 0.95rem;
        }

        .copy-button {
            position: absolute;
            top: 1rem;
            right: 1rem;
            background: rgba(255, 255, 255, 0.1);
            border: none;
            border-radius: 8px;
            padding: 0.5rem;
            color: #ccc;
            cursor: pointer;
            opacity: 0;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
            font-size: 0.9rem;
        }

        .note-card.selected .copy-button {
            opacity: 1;
        }

        .copy-button:hover {
            background: rgba(255, 255, 255, 0.2);
            color: #fff;
            transform: scale(1.1);
        }

        .copy-button.copied {
            background: rgba(120, 119, 198, 0.3);
            color: #7877c6;
        }

        .create-note-btn {
            position: fixed;
            bottom: 2rem;
            right: 2rem;
            background: linear-gradient(135deg, #7877c6, #ff77c6);
            border: none;
            border-radius: 16px;
            padding: 0.8rem 1.2rem;
            color: white;
            font-weight: 600;
            font-size: 0.9rem;
            cursor: pointer;
            box-shadow: 0 8px 32px rgba(120, 119, 198, 0.3);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            backdrop-filter: blur(10px);
            animation: buttonPulse 2s infinite;
            z-index: 100;
            white-space: nowrap;
        }

        .create-note-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 12px 48px rgba(120, 119, 198, 0.4);
            background: linear-gradient(135deg, #8988d4, #ff88d4);
        }

        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(10px);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            animation: fadeIn 0.3s ease-out;
        }

        .modal-content {
            background: rgba(20, 20, 20, 0.95);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 24px;
            padding: 2rem;
            max-width: 500px;
            width: 90%;
            backdrop-filter: blur(20px);
            animation: modalSlideUp 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .modal-title {
            font-size: 1.5rem;
            font-weight: 700;
            margin-bottom: 1.5rem;
            color: #ffffff;
        }

        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-label {
            display: block;
            margin-bottom: 0.5rem;
            color: #ccc;
            font-weight: 500;
        }

        .form-input,
        .form-textarea {
            width: 100%;
            padding: 0.75rem 1rem;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            color: #ffffff;
            font-size: 1rem;
            transition: all 0.3s ease;
        }

        .form-textarea {
            min-height: 120px;
            resize: vertical;
        }

        .form-input:focus,
        .form-textarea:focus {
            outline: none;
            border-color: rgba(120, 119, 198, 0.5);
            background: rgba(255, 255, 255, 0.08);
        }

        .modal-buttons {
            display: flex;
            gap: 1rem;
            justify-content: flex-end;
        }

        .btn {
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: 12px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .btn-primary {
            background: linear-gradient(135deg, #7877c6, #ff77c6);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-1px);
            box-shadow: 0 8px 24px rgba(120, 119, 198, 0.3);
        }

        .btn-secondary {
            background: rgba(255, 255, 255, 0.1);
            color: #ccc;
        }

        .btn-secondary:hover {
            background: rgba(255, 255, 255, 0.15);
        }

        @keyframes fadeInDown {
            from {
                opacity: 0;
                transform: translateY(-30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes noteAppear {
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes buttonPulse {
            0%, 100% {
                box-shadow: 0 8px 32px rgba(120, 119, 198, 0.3);
            }
            50% {
                box-shadow: 0 8px 32px rgba(120, 119, 198, 0.5);
            }
        }

        @keyframes modalSlideUp {
            from {
                opacity: 0;
                transform: translateY(50px) scale(0.95);
            }
            to {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }

        @media (max-width: 768px) {
            .title {
                font-size: 2rem;
            }
            
            .notes-grid {
                grid-template-columns: 1fr;
                gap: 1rem;
            }
            
            .create-note-btn {
                bottom: 1rem;
                right: 1rem;
                left: auto;
                width: auto;
                text-align: center;
            }
        }
    </style>
</head>
<body>
    <div class="background-gradient"></div>
    
    <div class="container">
        <div class="header">
            <h1 class="title">ScriptyNote</h1>
            <p class="subtitle">Capture your thoughts, organize your ideas</p>
        </div>

        <div class="search-container">
            <div class="search-icon">🔍</div>
            <input type="text" class="search-input" placeholder="Search notes, dates, or users..." id="searchInput">
        </div>

        <div class="notes-grid" id="notesGrid">
            <!-- Notes will be populated here -->
        </div>
    </div>

    <button class="create-note-btn" onclick="openModal()">
        ✨ Create Note
    </button>

    <div class="modal" id="noteModal">
        <div class="modal-content">
            <h2 class="modal-title">Create New Note</h2>
            <form id="noteForm">
                <div class="form-group">
                    <label class="form-label">Title</label>
                    <input type="text" class="form-input" id="noteTitle" required>
                </div>
                <div class="form-group">
                    <label class="form-label">Content</label>
                    <textarea class="form-textarea" id="noteContent" required></textarea>
                </div>
                <div class="form-group">
                    <label class="form-label">Your Name</label>
                    <input type="text" class="form-input" id="noteUser" required>
                </div>
                <div class="modal-buttons">
                    <button type="button" class="btn btn-secondary" onclick="closeModal()">Cancel</button>
                    <button type="submit" class="btn btn-primary">Create Note</button>
                </div>
            </form>
        </div>
    </div>

    <script>
        // Persistent note storage system
        const STORAGE_KEY = 'scriptynote_data';
        const DATA_VERSION = '1.0';
        let notes = [];
        let selectedNoteId = null;
        
        // Default sample notes
        const defaultNotes = [
            {
                id: 1,
                title: "Welcome to ScriptyNote",
                content: "This is your first note! You can create, search, and organize all your thoughts here. The interface is designed to be clean and intuitive. Your notes are automatically saved and will persist forever!",
                user: "System",
                date: new Date('2025-06-20T10:00:00').toISOString(),
                created: new Date('2025-06-20T10:00:00').toISOString()
            },
            {
                id: 2,
                title: "Project Ideas",
                content: "Build a modern web application with React and Node.js. Focus on user experience and performance optimization. Consider implementing real-time features and PWA capabilities.",
                user: "Alex Chen",
                date: new Date('2025-06-19T15:30:00').toISOString(),
                created: new Date('2025-06-19T15:30:00').toISOString()
            },
            {
                id: 3,
                title: "Meeting Notes",
                content: "Discussed Q3 roadmap, new feature implementations, and team restructuring. Action items: Review designs by Friday, schedule follow-up meeting with stakeholders.",
                user: "Sarah Johnson",
                date: new Date('2025-06-18T14:15:00').toISOString(),
                created: new Date('2025-06-18T14:15:00').toISOString()
            },
            {
                id: 4,
                title: "Learning Goals",
                content: "Master advanced CSS animations, learn Three.js for 3D web experiences, and improve TypeScript skills. Also explore WebAssembly and Progressive Web Apps.",
                user: "Mike Rodriguez",
                date: new Date('2025-06-17T09:45:00').toISOString(),
                created: new Date('2025-06-17T09:45:00').toISOString()
            },
            {
                id: 5,
                title: "Recipe Collection",
                content: "Tried the new pasta recipe today - amazing! Need to adjust seasoning next time. Add more garlic and herbs. Will definitely make this again for dinner parties.",
                user: "Emma Wilson",
                date: new Date('2025-06-16T19:20:00').toISOString(),
                created: new Date('2025-06-16T19:20:00').toISOString()
            }
        ];

        // Enhanced storage functions with fallback mechanisms
        function saveNotes() {
            try {
                const dataToSave = {
                    version: DATA_VERSION,
                    notes: notes,
                    timestamp: new Date().toISOString(),
                    backup: true
                };
                
                // Try multiple storage methods
                const serializedData = JSON.stringify(dataToSave);
                
                // Method 1: Try standard storage first
                try {
                    if (typeof Storage !== 'undefined') {
                        localStorage.setItem(STORAGE_KEY, serializedData);
                        localStorage.setItem(STORAGE_KEY + '_backup', serializedData);
                    }
                } catch (e) {
                    console.warn('localStorage not available, using fallback');
                }
                
                // Method 2: IndexedDB fallback
                try {
                    if ('indexedDB' in window) {
                        saveToIndexedDB(dataToSave);
                    }
                } catch (e) {
                    console.warn('IndexedDB not available');
                }
                
                // Method 3: Cookie fallback (for essential data)
                try {
                    const essentialData = {
                        version: DATA_VERSION,
                        count: notes.length,
                        lastSaved: new Date().toISOString()
                    };
                    document.cookie = `scriptynote_meta=${JSON.stringify(essentialData)}; expires=Fri, 31 Dec 9999 23:59:59 GMT; path=/`;
                } catch (e) {
                    console.warn('Cookie storage failed');
                }
                
                console.log('Notes saved successfully');
            } catch (error) {
                console.error('Failed to save notes:', error);
            }
        }

        function loadNotes() {
            try {
                let loadedData = null;
                
                // Try to load from localStorage first
                try {
                    if (typeof Storage !== 'undefined') {
                        const stored = localStorage.getItem(STORAGE_KEY);
                        if (stored) {
                            loadedData = JSON.parse(stored);
                        } else {
                            // Try backup
                            const backup = localStorage.getItem(STORAGE_KEY + '_backup');
                            if (backup) {
                                loadedData = JSON.parse(backup);
                            }
                        }
                    }
                } catch (e) {
                    console.warn('localStorage read failed, trying alternatives');
                }
                
                // If localStorage failed, try IndexedDB
                if (!loadedData) {
                    try {
                        loadFromIndexedDB().then(data => {
                            if (data && data.notes) {
                                notes = data.notes.map(note => ({
                                    ...note,
                                    date: new Date(note.date),
                                    created: new Date(note.created || note.date)
                                }));
                                renderNotes();
                            }
                        });
                    } catch (e) {
                        console.warn('IndexedDB read failed');
                    }
                }
                
                if (loadedData && loadedData.notes && Array.isArray(loadedData.notes)) {
                    // Validate and restore notes
                    notes = loadedData.notes.map(note => ({
                        ...note,
                        date: new Date(note.date),
                        created: new Date(note.created || note.date)
                    }));
                    console.log(`Loaded ${notes.length} notes from storage`);
                } else {
                    // First time user - initialize with default notes
                    console.log('No saved notes found, initializing with defaults');
                    notes = defaultNotes.map(note => ({
                        ...note,
                        date: new Date(note.date),
                        created: new Date(note.created || note.date)
                    }));
                    // Save the default notes immediately
                    saveNotes();
                }
            } catch (error) {
                console.error('Failed to load notes:', error);
                // Fallback to default notes
                notes = defaultNotes.map(note => ({
                    ...note,
                    date: new Date(note.date),
                    created: new Date(note.created || note.date)
                }));
            }
        }

        // IndexedDB functions for additional persistence
        function saveToIndexedDB(data) {
            const request = indexedDB.open('ScriptyNoteDB', 1);
            
            request.onupgradeneeded = function(event) {
                const db = event.target.result;
                if (!db.objectStoreNames.contains('notes')) {
                    db.createObjectStore('notes', { keyPath: 'id' });
                }
                if (!db.objectStoreNames.contains('metadata')) {
                    db.createObjectStore('metadata', { keyPath: 'key' });
                }
            };
            
            request.onsuccess = function(event) {
                const db = event.target.result;
                const transaction = db.transaction(['metadata'], 'readwrite');
                const store = transaction.objectStore('metadata');
                store.put({ key: 'appData', data: data });
            };
        }

        function loadFromIndexedDB() {
            return new Promise((resolve, reject) => {
                const request = indexedDB.open('ScriptyNoteDB', 1);
                
                request.onsuccess = function(event) {
                    const db = event.target.result;
                    const transaction = db.transaction(['metadata'], 'readonly');
                    const store = transaction.objectStore('metadata');
                    const getRequest = store.get('appData');
                    
                    getRequest.onsuccess = function() {
                        if (getRequest.result) {
                            resolve(getRequest.result.data);
                        } else {
                            resolve(null);
                        }
                    };
                    
                    getRequest.onerror = function() {
                        reject(getRequest.error);
                    };
                };
                
                request.onerror = function() {
                    reject(request.error);
                };
            });
        }

        function formatDate(date) {
            const now = new Date();
            const diffTime = Math.abs(now - date);
            const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
            
            if (diffDays === 1) return 'Yesterday';
            if (diffDays < 7) return `${diffDays} days ago`;
            
            return date.toLocaleDateString('en-US', {
                month: 'short',
                day: 'numeric',
                year: date.getFullYear() !== now.getFullYear() ? 'numeric' : undefined
            });
        }

        function truncateText(text, maxLength = 60) {
            if (text.length <= maxLength) return text;
            return text.substring(0, maxLength) + '…';
        }

        function copyNoteContent(noteId) {
            const note = notes.find(n => n.id === noteId);
            if (!note) return;

            navigator.clipboard.writeText(note.content).then(() => {
                const copyButton = document.querySelector(`[data-note-id="${noteId}"] .copy-button`);
                if (copyButton) {
                    const originalHTML = copyButton.innerHTML;
                    copyButton.innerHTML = '<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="20,6 9,17 4,12"></polyline></svg>';
                    copyButton.classList.add('copied');
                    
                    setTimeout(() => {
                        copyButton.innerHTML = originalHTML;
                        copyButton.classList.remove('copied');
                    }, 2000);
                }
            }).catch(err => {
                console.error('Failed to copy:', err);
            });
        }

        function selectNote(noteId, event) {
            // Prevent selecting when clicking the copy button
            if (event.target.classList.contains('copy-button')) {
                return;
            }

            // Remove previous selection
            document.querySelectorAll('.note-card').forEach(card => {
                card.classList.remove('selected');
            });

            // Add selection to clicked note
            const noteCard = event.currentTarget;
            noteCard.classList.add('selected');
            selectedNoteId = noteId;
        }

        function renderNotes(notesToRender = notes) {
            const notesGrid = document.getElementById('notesGrid');
            
            if (notesToRender.length === 0) {
                notesGrid.innerHTML = `
                    <div style="grid-column: 1 / -1; text-align: center; padding: 2rem; color: #666;">
                        <p>No notes found. Create your first note!</p>
                    </div>
                `;
                return;
            }
            
            // Sort notes by date (newest first)
            const sortedNotes = [...notesToRender].sort((a, b) => new Date(b.date) - new Date(a.date));
            const recentNotes = sortedNotes.slice(0, 100); // Show up to 100 notes
            
            notesGrid.innerHTML = recentNotes.map((note, index) => `
                <div class="note-card" data-note-id="${note.id}" style="animation-delay: ${index * 0.05}s" onclick="selectNote(${note.id}, event)">
                    <button class="copy-button" onclick="copyNoteContent(${note.id})">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
                            <path d="m5,15H4a2,2,0,0,1-2-2V4A2,2,0,0,1,4,2H13a2,2,0,0,1,2,2v1"></path>
                        </svg>
                    </button>
                    <div class="note-header">
                        <div class="note-user">${escapeHtml(note.user)}</div>
                        <div class="note-date">${formatDate(note.date)}</div>
                    </div>
                    <div class="note-title">${escapeHtml(note.title)}</div>
                    <div class="note-content">${escapeHtml(truncateText(note.content))}</div>
                </div>
            `).join('');
        }

        // Escape HTML to prevent XSS
        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        function searchNotes() {
            const searchTerm = document.getElementById('searchInput').value.toLowerCase().trim();
            
            if (!searchTerm) {
                renderNotes();
                return;
            }
            
            const filteredNotes = notes.filter(note => 
                note.title.toLowerCase().includes(searchTerm) ||
                note.content.toLowerCase().includes(searchTerm) ||
                note.user.toLowerCase().includes(searchTerm) ||
                formatDate(note.date).toLowerCase().includes(searchTerm)
            );
            
            renderNotes(filteredNotes);
        }

        function openModal() {
            document.getElementById('noteModal').style.display = 'flex';
            document.body.style.overflow = 'hidden';
            // Focus on the title input
            setTimeout(() => {
                document.getElementById('noteTitle').focus();
            }, 100);
        }

        function closeModal() {
            document.getElementById('noteModal').style.display = 'none';
            document.body.style.overflow = 'auto';
            document.getElementById('noteForm').reset();
        }

        function createNote(event) {
            event.preventDefault();
            
            const title = document.getElementById('noteTitle').value.trim();
            const content = document.getElementById('noteContent').value.trim();
            const user = document.getElementById('noteUser').value.trim();
            
            // Validation
            if (!title || !content || !user) {
                alert('Please fill in all fields');
                return;
            }
            
            // Generate new ID
            const newId = notes.length > 0 ? Math.max(...notes.map(n => n.id)) + 1 : 1;
            const now = new Date();
            
            const newNote = {
                id: newId,
                title,
                content,
                user,
                date: now,
                created: now
            };
            
            // Add to beginning of array (newest first)
            notes.unshift(newNote);
            
            // Save to persistent storage immediately
            saveNotes();
            
            // Re-render notes
            renderNotes();
            
            // Close modal
            closeModal();
            
            // Add success animation to the first card
            setTimeout(() => {
                const firstCard = document.querySelector('.note-card');
                if (firstCard) {
                    firstCard.style.background = 'rgba(120, 119, 198, 0.1)';
                    setTimeout(() => {
                        firstCard.style.background = 'rgba(255, 255, 255, 0.03)';
                    }, 1000);
                }
            }, 100);
        }

        // Auto-save functionality
        function enableAutoSave() {
            // Save every 30 seconds as a backup
            setInterval(saveNotes, 30000);
            
            // Save when page is about to be closed
            window.addEventListener('beforeunload', function(e) {
                saveNotes();
            });
            
            // Save when page becomes hidden (mobile/tab switching)
            document.addEventListener('visibilitychange', function() {
                if (document.hidden) {
                    saveNotes();
                }
            });
            
            // Save when browser loses focus
            window.addEventListener('blur', function() {
                saveNotes();
            });
        }

        // Event listeners
        document.getElementById('searchInput').addEventListener('input', searchNotes);
        document.getElementById('noteForm').addEventListener('submit', createNote);
        
        // Close modal when clicking outside
        document.getElementById('noteModal').addEventListener('click', function(e) {
            if (e.target === this) {
                closeModal();
            }
        });

        // Close modal with Escape key
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape' && document.getElementById('noteModal').style.display === 'flex') {
                closeModal();
            }
        });

        // Deselect note when clicking outside
        document.addEventListener('click', function(e) {
            if (!e.target.closest('.note-card')) {
                document.querySelectorAll('.note-card').forEach(card => {
                    card.classList.remove('selected');
                });
                selectedNoteId = null;
            }
        });

        // Data integrity check
        function validateNotes() {
            // Remove any corrupted notes
            notes = notes.filter(note => 
                note && 
                typeof note.id !== 'undefined' && 
                note.title && 
                note.content && 
                note.user
            );
            
            // Ensure all notes have proper date objects
            notes.forEach(note => {
                if (typeof note.date === 'string') {
                    note.date = new Date(note.date);
                }
                if (!note.created) {
                    note.created = note.date;
                } else if (typeof note.created === 'string') {
                    note.created = new Date(note.created);
                }
            });
        }

        // Initialize the application
        document.addEventListener('DOMContentLoaded', function() {
            console.log('ScriptyNote initializing...');
            
            // Load notes from storage
            loadNotes();
            
            // Validate loaded notes
            validateNotes();
            
            // Render notes
            renderNotes();
            
            // Enable auto-save
            enableAutoSave();
            
            // Clear search when page loads
            document.getElementById('searchInput').value = '';
            
            // Log initialization status
            console.log(`ScriptyNote initialized with ${notes.length} notes`);
            
            // Periodic data integrity check
            setInterval(function() {
                validateNotes();
                if (notes.length > 0) {
                    saveNotes();
                }
            }, 60000); // Check every minute
        });

        // Export/Import functionality (future enhancement)
        function exportNotes() {
            try {
                const exportData = {
                    version: DATA_VERSION,
                    exportDate: new Date().toISOString(),
                    notes: notes,
                    count: notes.length
                };
                
                const dataStr = JSON.stringify(exportData, null, 2);
                const dataBlob = new Blob([dataStr], {type: 'application/json'});
                
                const url = URL.createObjectURL(dataBlob);
                const link = document.createElement('a');
                link.href = url;
                link.download = `scriptynote_backup_${new Date().toISOString().split('T')[0]}.json`;
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                URL.revokeObjectURL(url);
                
                console.log('Notes exported successfully');
            } catch (error) {
                console.error('Failed to export notes:', error);
            }
        }

        // Expose functions for debugging
        window.ScriptyNote = {
            exportNotes,
            saveNotes,
            loadNotes,
            validateNotes,
            notes: () => notes,
            version: DATA_VERSION
        };
    </script>
</body>
</html>
